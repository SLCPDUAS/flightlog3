<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flight Tracker - Randy Neal</title>

<style>
:root{
  --bg:#0f1115;--card:#1c1f26;--text:#f1f1f1;
  --primary:#4da3ff;--danger:#ff6b6b;--border:#333;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;
}
header{
  background:#111;
  padding:14px;
  text-align:center;
  position:sticky;
  top:0;
}
section{
  background:var(--card);
  margin:12px;
  padding:14px;
  border-radius:12px;
}
label{display:block;margin-top:10px}
input,textarea,select{
  width:100%;
  padding:12px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid var(--border);
  background:#000;
  color:#fff;
}
button{
  width:100%;
  margin-top:12px;
  padding:14px;
  border:none;
  border-radius:10px;
  font-size:16px;
}
.start{background:#27ae60;color:#fff}
.stop{background:#c0392b;color:#fff}
.reset{background:#7f8c8d;color:#fff}
.primary{background:var(--primary);color:#000}
.danger{background:var(--danger);color:#000}
.timer{text-align:center;font-size:2em;margin:12px}
.card{background:#000;padding:10px;border-radius:8px;margin-bottom:8px}
</style>
</head>

<body>

<header>
  <h2>Flight Tracker</h2>
  <div>Randy Neal â€“ FAA #5208259</div>
</header>

<section>
  <label>Drone</label>
  <select id="drone"></select>

  <label>Location</label>
  <input id="location" />

  <label>Reason</label>
  <select id="reason">
    <option value="">Select</option>
    <option>Recreational</option>
    <option>Training</option>
    <option>SLCPD</option>
  </select>

  <label>Wind</label>
  <input id="wind" />

  <label>LAANC</label>
  <input id="laanc" />

  <label>Notes</label>
  <textarea id="notes"></textarea>

  <div class="timer" id="timer">00:00</div>

  <button class="start" onclick="startTimer()">Start</button>
  <button class="stop" onclick="stopTimer()">Stop</button>
  <button class="reset" onclick="resetFlight()">Reset</button>

  <button class="primary" onclick="saveFlight()">Save Flight</button>
</section>

<section>
  <button class="primary" onclick="toggleHistory()">Flight History</button>
  <div id="history" style="display:none"></div>
</section>

<section>
  <button class="primary" onclick="toggleMaint()">Drone Maintenance</button>
  <div id="maint" style="display:none">
    <select id="mDrone"></select>
    <textarea id="mIssues" placeholder="Issues"></textarea>
    <textarea id="mWork" placeholder="Maintenance"></textarea>
    <button class="primary" onclick="saveMaint()">Save Maintenance</button>
    <div id="maintHistory"></div>
  </div>
</section>

<script type="module">
/* ---------- FIREBASE ---------- */
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, query, orderBy, enableIndexedDbPersistence }
from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDe0dVJ19xr29sX7S7burryDmh7Z6YwL_s",
  authDomain: "drone-flight-log-24580.firebaseapp.com",
  projectId: "drone-flight-log-24580",
  storageBucket: "drone-flight-log-24580.firebasestorage.app",
  messagingSenderId: "746343740289",
  appId: "1:746343740289:web:68939753c6e7c6898a6e80"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ðŸ”´ REQUIRED FOR SAFARI */
enableIndexedDbPersistence(db).catch(()=>{});

/* ---------- DATA ---------- */
const drones=[
"Skyrover S1","DJI Mini 3 Pro #1","DJI Avata Patrol #1","DJI Avata Patrol #2",
"DJI Mavic 3T #1.2","DJI Mavic 3T #2.1","DJI Mavic #3",
"DJI Matrice 4T #1","DJI Matrice 4T #2","DJI Matrice 4T #3",
"DJI Mavic 3E #1","DJI Mavic PT30T #1",
"Skydio 10-1","Skydio 10-2-2","Skydio 10-3","Skydio 10-4","Skydio 10-5",
"Autel 640 V3 #1"
];

const dSel=document.getElementById("drone");
const mSel=document.getElementById("mDrone");
drones.forEach(d=>{
  dSel.innerHTML+=`<option>${d}</option>`;
  mSel.innerHTML+=`<option>${d}</option>`;
});

/* ---------- TIMER ---------- */
let t=null,sec=0;
function upd(){document.getElementById("timer").innerText=
String(Math.floor(sec/60)).padStart(2,"0")+":"+String(sec%60).padStart(2,"0");}
window.startTimer=()=>{if(t)return;t=setInterval(()=>{sec++;upd()},1000)};
window.stopTimer=()=>{clearInterval(t);t=null};
window.resetFlight=()=>{stopTimer();sec=0;upd();["location","wind","laanc","notes"].forEach(i=>document.getElementById(i).value="")};

/* ---------- SAVE FLIGHT ---------- */
window.saveFlight=async()=>{
  await addDoc(collection(db,"flights"),{
    date:new Date().toISOString(),
    drone:dSel.value,
    location:location.value,
    reason:reason.value,
    wind:wind.value,
    laanc:laanc.value,
    notes:notes.value,
    time:timer.innerText
  });
  resetFlight();
};

/* ---------- HISTORY ---------- */
const hist=document.getElementById("history");
window.toggleHistory=()=>hist.style.display=hist.style.display==="none"?"block":"none";

onSnapshot(query(collection(db,"flights"),orderBy("date","desc")),snap=>{
  hist.innerHTML="";
  snap.forEach(d=>{
    const f=d.data();
    hist.innerHTML+=`
    <div class="card">
      <strong>${f.drone}</strong><br>
      ${f.time} â€“ ${new Date(f.date).toLocaleString()}<br>
      ${f.location}<br>
      ${f.reason}<br>
      <button class="danger" onclick="deleteFlight('${d.id}')">Delete</button>
    </div>`;
  });
});

window.deleteFlight=async(id)=>await deleteDoc(doc(db,"flights",id));

/* ---------- MAINT ---------- */
const mh=document.getElementById("maintHistory");
window.toggleMaint=()=>maint.style.display=maint.style.display==="none"?"block":"none";

window.saveMaint=async()=>{
  await addDoc(collection(db,"maintenance"),{
    date:new Date().toISOString(),
    drone:mDrone.value,
    issues:mIssues.value,
    work:mWork.value
  });
};

onSnapshot(query(collection(db,"maintenance"),orderBy("date","desc")),snap=>{
  mh.innerHTML="";
  snap.forEach(d=>{
    const m=d.data();
    mh.innerHTML+=`
    <div class="card">
      <strong>${m.drone}</strong><br>
      ${m.issues}<br>${m.work}
    </div>`;
  });
});
</script>
</body>
</html>
