<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Flight Tracker - Randy Neal</title>

<style>
:root {
  --bg:#f2f4f7;
  --card:#ffffff;
  --text:#111;
  --primary:#1f3a5f;
  --secondary:#666;
  --danger:#c0392b;
  --border:#ccc;
}

body.dark {
  --bg:#0f1115;
  --card:#1c1f26;
  --text:#f1f1f1;
  --primary:#4da3ff;
  --secondary:#999;
  --danger:#ff6b6b;
  --border:#333;
}

* { box-sizing:border-box; }

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
  padding:env(safe-area-inset-top) env(safe-area-inset-right)
          env(safe-area-inset-bottom) env(safe-area-inset-left);
}

header {
  background:var(--primary);
  color:#fff;
  padding:16px;
  text-align:center;
  position:sticky;
  top:0;
  z-index:10;
}

section {
  background:var(--card);
  margin:12px;
  padding:14px;
  border-radius:12px;
}

label {
  display:block;
  margin-top:12px;
  font-weight:600;
}

input, textarea {
  width:100%;
  margin-top:6px;
  padding:12px;
  font-size:16px;
  border-radius:8px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
}

textarea { min-height:70px; }

button {
  width:100%;
  padding:14px;
  margin-top:12px;
  font-size:16px;
  border-radius:10px;
  border:none;
  background:var(--primary);
  color:#fff;
}

button.secondary { background:var(--secondary); }
button.danger { background:var(--danger); }

.timer {
  text-align:center;
  font-size:2em;
  font-weight:bold;
  margin:12px 0;
}

.timer-controls {
  display:flex;
  gap:8px;
}

.timer-controls button { flex:1; }

.card {
  background:var(--bg);
  border-radius:10px;
  padding:12px;
  margin-bottom:10px;
}

.card strong {
  display:block;
  margin-top:6px;
}
</style>
</head>

<body>

<header>
  <h1>Flight Tracker</h1>
  <p>Randy Neal<br>FAA Pilot License #5208259</p>
  <button class="secondary" type="button" onclick="toggleDark()">Toggle Dark Mode</button>
</header>

<section>
<h3>Flight Log</h3>

<label>Drone Flown *</label>
<input id="drone">

<label>Location *</label>
<input id="location">

<label>Reason for Flight *</label>
<input id="reason">

<label>Weather</label>
<input id="wind">

<label>LAANC Authorization Number</label>
<input id="laanc">

<label>Preflight Notes</label>
<textarea id="notes"></textarea>

<div class="timer" id="timer">00:00</div>

<div class="timer-controls">
  <button type="button" onclick="startTimer()">Start</button>
  <button type="button" class="secondary" onclick="stopTimer()">End</button>
  <button type="button" class="secondary" onclick="resetTimer()">Reset</button>
</div>

<button type="button" onclick="saveFlight()">Save Flight</button>
</section>

<section>
<h3>Flight History</h3>
<div id="flightHistory"></div>
</section>

<section>
<h3>Drone Maintenance</h3>

<label>Drone</label>
<input id="mDrone">

<label>Issues Found</label>
<textarea id="mIssues"></textarea>

<label>Maintenance Performed</label>
<textarea id="mWork"></textarea>

<button type="button" onclick="saveMaintenance()">Save Maintenance</button>

<div id="maintenanceHistory"></div>
</section>

<script>
/* ---------- HELPERS ---------- */
const $ = id => document.getElementById(id);
const safeParse = key => {
  try { return JSON.parse(localStorage.getItem(key)) || []; }
  catch { return []; }
};

/* ---------- DARK MODE ---------- */
(function initDark(){
  const saved = localStorage.getItem("darkMode");
  if (
    saved === "true" ||
    (saved === null && window.matchMedia("(prefers-color-scheme: dark)").matches)
  ) {
    document.body.classList.add("dark");
  }
})();

function toggleDark(){
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode", document.body.classList.contains("dark"));
}

/* ---------- TIMER ---------- */
let timerInterval = null;
let seconds = Number(localStorage.getItem("timerSeconds")) || 0;

function updateTimer(){
  $("timer").textContent =
    String(Math.floor(seconds/60)).padStart(2,"0") + ":" +
    String(seconds%60).padStart(2,"0");
}

updateTimer();

function startTimer(){
  if (timerInterval) return;
  timerInterval = setInterval(() => {
    seconds++;
    localStorage.setItem("timerSeconds", seconds);
    updateTimer();
  }, 1000);
}

function stopTimer(){
  clearInterval(timerInterval);
  timerInterval = null;
}

function resetTimer(){
  stopTimer();
  seconds = 0;
  localStorage.removeItem("timerSeconds");
  updateTimer();
}

/* ---------- FLIGHTS ---------- */
function saveFlight(){
  if (!$("drone").value || !$("location").value || !$("reason").value) {
    alert("Drone, Location, and Reason are required.");
    return;
  }

  const flights = safeParse("flights");
  flights.push({
    date: new Date().toLocaleString(),
    drone: $("drone").value,
    location: $("location").value,
    reason: $("reason").value,
    wind: $("wind").value,
    laanc: $("laanc").value,
    notes: $("notes").value,
    time: $("timer").textContent
  });

  localStorage.setItem("flights", JSON.stringify(flights));
  resetTimer();
  renderFlights();
}

function deleteFlight(i){
  const flights = safeParse("flights");
  flights.splice(i,1);
  localStorage.setItem("flights", JSON.stringify(flights));
  renderFlights();
}

function renderFlights(){
  $("flightHistory").innerHTML = "";
  safeParse("flights").forEach((f,i) => {
    $("flightHistory").innerHTML += `
      <div class="card">
        <strong>Date:</strong>${f.date}
        <strong>Drone:</strong>${f.drone}
        <strong>Location:</strong>${f.location}
        <strong>Reason:</strong>${f.reason}
        <strong>Wind:</strong>${f.wind}
        <strong>LAANC:</strong>${f.laanc}
        <strong>Notes:</strong>${f.notes}
        <strong>Time:</strong>${f.time}
        <button class="danger" type="button" onclick="deleteFlight(${i})">Delete</button>
      </div>`;
  });
}

/* ---------- MAINTENANCE ---------- */
function saveMaintenance(){
  const logs = safeParse("maintenance");
  logs.push({
    date: new Date().toLocaleString(),
    drone: $("mDrone").value,
    issues: $("mIssues").value,
    work: $("mWork").value
  });
  localStorage.setItem("maintenance", JSON.stringify(logs));
  renderMaintenance();
}

function deleteMaintenance(i){
  const logs = safeParse("maintenance");
  logs.splice(i,1);
  localStorage.setItem("maintenance", JSON.stringify(logs));
  renderMaintenance();
}

function renderMaintenance(){
  $("maintenanceHistory").innerHTML = "";
  safeParse("maintenance").forEach((m,i) => {
    $("maintenanceHistory").innerHTML += `
      <div class="card">
        <strong>Date:</strong>${m.date}
        <strong>Drone:</strong>${m.drone}
        <strong>Issues:</strong>${m.issues}
        <strong>Maintenance:</strong>${m.work}
        <button class="danger" type="button" onclick="deleteMaintenance(${i})">Delete</button>
      </div>`;
  });
}

renderFlights();
renderMaintenance();
</script>

</body>
</html>

